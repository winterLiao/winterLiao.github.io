<!DOCTYPE html><html lang="zh-cn,en,default"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Swift视频播放器 · winter</title><meta name="description" content="Swift视频播放器 - 廖文韬"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="https://winterliao.github.io/atom.xml" title="winter"></head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">winter</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>主页</p></a><a href="/archives" target="_self" class="li component-nav-item"><p>归档</p></a><ul class="shortcut-icons"><a href="https://github.com/winterLiao" target="_blank"><img src="/images/github.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">Swift视频播放器</h1><div class="post-info">2018年8月6日</div><div class="post-content"><p>iOS上除了一些第三方的播放器之外，我们一般常用的播放方式有使用:</p>
<ul>
<li>网页播放:播放方式简单、固定，不可自定义</li>
<li>AVPlayer:自定义UI，目前大多数的第三方播放软件都是基于这个进行封装</li>
<li>AVPlayerViewController: 封装好的AVPlayer，可以直接作为视图控制器弹出播放，也可以使用添加view方式使用，不可以自定义UI。</li>
<li>MPMoviewViewController：使用添加view方式使用,自带UI，使用较为麻烦,iOS 9.0后被废弃，使用AVPlayerViewController替代</li>
<li>MPMoviePlayerViewController:可以直接作为视图控制器弹出播放，自带UI，方便使用，全屏播放，iOS 9.0后被废弃，使用AVPlayerViewController替代</li>
</ul>
<p>一般简单的播放url可以使用网页播放的模式，有很多主流app的视频打开都是用的这种。不需要UI自定义的时候我们选择AVPlayerViewController，比较方便快捷。自定义需求较多时最好选用AVPlayer。</p>
<h3 id="AVPlayer"><a href="#AVPlayer" class="headerlink" title="AVPlayer"></a>AVPlayer</h3><p>功能最全、自定义最高的播放器，也是使用最多得。使用起来较为复杂些。需导入AVKit控件<br>AVPlayer功能比较多，另外写了一篇文章：<br><a href="https://www.jianshu.com/p/20e5e6d5f3e5">AVPlayer播放器</a></p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><div class="line"><span class="comment">//创建媒体资源管理对象</span></div><div class="line">self<span class="selector-class">.palyerItem</span> = AVPlayerItem(url: NSURL(string: urlString)! as URL)</div><div class="line"><span class="comment">//创建ACplayer：负责视频播放</span></div><div class="line">self<span class="selector-class">.player</span> = AVPlayer.init(playerItem: self.palyerItem)</div><div class="line">self<span class="selector-class">.player</span><span class="selector-class">.rate</span> = <span class="number">1.0</span><span class="comment">//播放速度 播放前设置</span></div><div class="line"><span class="comment">//创建显示视频的图层</span></div><div class="line">let playerLayer = AVPlayerLayer.init(player: self.player)</div><div class="line">playerLayer<span class="selector-class">.videoGravity</span> = <span class="selector-class">.resizeAspect</span></div><div class="line">playerLayer<span class="selector-class">.frame</span> = self<span class="selector-class">.view</span><span class="selector-class">.bounds</span></div><div class="line">self<span class="selector-class">.view</span><span class="selector-class">.layer</span> .addSublayer(playerLayer)</div><div class="line"><span class="comment">//播放</span></div><div class="line">self<span class="selector-class">.player</span><span class="selector-class">.play</span>()</div></pre></td></tr></table></figure>
<p>只是让视频播放起来，没有暂停、停止、快进等等功能。</p>
<h3 id="AVPlayerViewController"><a href="#AVPlayerViewController" class="headerlink" title="AVPlayerViewController"></a>AVPlayerViewController</h3><p>适用于简单的播放，不需要过多自定义的东西，使用比较简单，有两种方式，需要引入AVKit框架<br>(1)添加view<br>可以设置播放器的大小<br><figure class="highlight vim"><table><tr><td class="code"><pre><div class="line"><span class="keyword">let</span> player = AVPlayer(ur<span class="variable">l:</span> NSURL(strin<span class="variable">g:</span> urlString)! <span class="keyword">as</span> URL)</div><div class="line"><span class="keyword">let</span> playerViewController = AVPlayerViewController()</div><div class="line">playerViewController.player = player</div><div class="line">//添加<span class="keyword">view</span>播放的模式</div><div class="line">playerViewController.<span class="keyword">view</span>.frame = CGRect(<span class="keyword">x</span>: <span class="number">20</span>, <span class="keyword">y</span>: <span class="number">100</span>, width: self.<span class="keyword">view</span>.bounds.width - <span class="number">40</span>, heigh<span class="variable">t:</span> <span class="number">200</span>)</div><div class="line">self.addChildViewController(playerViewController)</div><div class="line">self.<span class="keyword">view</span>.addSubview(playerViewController.<span class="keyword">vie</span>)</div></pre></td></tr></table></figure></p>
<p>(2)作为视图控制器弹窗<br><figure class="highlight groovy"><table><tr><td class="code"><pre><div class="line"><span class="comment">//控制器推出的模式</span></div><div class="line">let player = AVPlayer(<span class="string">url:</span> NSURL(<span class="string">string:</span> urlString)! <span class="keyword">as</span> URL)</div><div class="line">let playerViewController = AVPlayerViewController()</div><div class="line">playerViewController.player = player</div><div class="line">self.present(playerViewController, <span class="string">animated:</span><span class="literal">true</span>, <span class="string">completion:</span> nil)</div></pre></td></tr></table></figure></p>
<h3 id="MPMoviePlayerViewController"><a href="#MPMoviePlayerViewController" class="headerlink" title="MPMoviePlayerViewController"></a>MPMoviePlayerViewController</h3><p>使用起来类似AVPlayerViewController的第一种方式。需要引入MediaPlayer框架（iOS9后被抛弃，使用AVPlayerViewController即可）<br><figure class="highlight swift"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> playerController : <span class="type">MPMoviePlayerController</span>?</div><div class="line">playerController = <span class="type">MPMoviePlayerController</span>(contentURL: <span class="type">NSURL</span>(string: urlString) <span class="keyword">as</span>! <span class="type">URL</span>)</div><div class="line">playerController?.view.frame = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">100</span>, width: <span class="keyword">self</span>.view.frame.width, height: <span class="number">300</span>)</div><div class="line"><span class="keyword">self</span>.view.addSubview((playerController?.view)!)</div><div class="line"><span class="comment">//设置为默认风格</span></div><div class="line"><span class="keyword">self</span>.playerController?.controlStyle = .<span class="keyword">default</span></div><div class="line"><span class="comment">//重复播放</span></div><div class="line"><span class="keyword">self</span>.playerController?.repeatMode = .one</div><div class="line"><span class="comment">//播放视频</span></div><div class="line"><span class="keyword">self</span>.playerController?.prepareToPlay()</div><div class="line"></div><div class="line"><span class="keyword">deinit</span> &#123;</div><div class="line"><span class="comment">//退出界面关闭播放，移除通知</span></div><div class="line"><span class="keyword">self</span>.playerController?.stop()</div><div class="line"><span class="keyword">self</span>.playerController = <span class="literal">nil</span></div><div class="line"><span class="type">NotificationCenter</span>.<span class="keyword">default</span>.removeObserver(<span class="keyword">self</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>通知来进行一些操作的监听<br><figure class="highlight less"><table><tr><td class="code"><pre><div class="line"><span class="comment">//播放完成监听（还有其他很多监听,如播放暂停、快进等）</span></div><div class="line"><span class="selector-tag">NotificationCenter</span><span class="selector-class">.default</span><span class="selector-class">.addObserver</span>(self,selecto <span class="attribute">r</span>:#selector(playerStateFinished(<span class="attribute">notification</span>:)),nam  <span class="attribute">e</span>: NSNotification.Name(<span class="attribute">rawValue</span>:MPMoviePlayerPlayba  ckDidFinishReasonUserInfoKy), <span class="attribute">object</span>: nil)</div><div class="line"></div><div class="line"><span class="comment">//播放结束监听</span></div><div class="line">@<span class="selector-tag">objc</span> <span class="selector-tag">func</span> <span class="selector-tag">playerStateFinished</span>(<span class="attribute">notification</span>:NSNotification)&#123;</div><div class="line"><span class="selector-tag">print</span>(<span class="string">"播放结束"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="MPMoviePlayerViewController-1"><a href="#MPMoviePlayerViewController-1" class="headerlink" title="MPMoviePlayerViewController"></a>MPMoviePlayerViewController</h3><p>使用起来类似AVPlayerViewController的第二种方式。需要引入MediaPlayer框架（iOS9后被抛弃，使用AVPlayerViewController即可）<br><figure class="highlight groovy"><table><tr><td class="code"><pre><div class="line">let playerViewController = MPMoviePlayerViewController(<span class="string">contentURL:</span> NSURL(<span class="string">string:</span> urlString)! <span class="keyword">as</span> URL)</div><div class="line">playerViewController?.moviePlayer.scalingMode = .aspectFit</div><div class="line">self.present(playerViewController!,animated:<span class="literal">true</span>, <span class="string">completion:</span> nil)</div></pre></td></tr></table></figure></p>
<h4 id="下载demo"><a href="#下载demo" class="headerlink" title="下载demo"></a>下载demo</h4><p><a href="https://github.com/winterLiao/VideoPlayerDemo">swift视频播放器使用</a></p>
</div></article></div><div id="disqus_thread"></div></div><script>var disqus_shortname = 'Winter';
var disqus_identifier = '2018/08/06/Swift视频播放器/';
var disqus_title = 'Swift视频播放器';
var disqus_url = 'https://winterliao.github.io/2018/08/06/Swift视频播放器/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//Winter.disqus.com/count.js" async></script></main><footer class="footer-container"><div class="paginator"><a href="/2018/08/06/AVPlayer使用/" class="prev">上一篇</a><a href="/2018/02/16/MGJRouterDemo/" class="next">下一篇</a></div><div class="copyright"><p>© 2017 - 2018 <a href="https://winterliao.github.io">廖文韬</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"Winter",'auto');ga('send','pageview');</script></body></html>