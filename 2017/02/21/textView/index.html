<!DOCTYPE html><html lang="zh-cn,en,default"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> TextView添加链接 · winter</title><meta name="description" content="TextView添加链接 - 廖文韬"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="https://winterliao.github.io/atom.xml" title="winter"></head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">winter</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>主页</p></a><a href="/archives" target="_self" class="li component-nav-item"><p>归档</p></a><ul class="shortcut-icons"><a href="https://github.com/winterLiao" target="_blank"><img src="/images/github.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">TextView添加链接</h1><div class="post-info">2017年2月21日</div><div class="post-content"><p>有时候我们需要实现一行文中中某些文字带有点击的功能，大多数情况下会采用label和button结合实现或者第三方富文本label，其实用textView添加链接实现起来非常方便。<br>实现如下效果:<br><img src="http://ok841h9gr.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-02-21%20%E4%B8%8B%E5%8D%883.34.35.png" alt="img"><br>需要设置得文字</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="built_in">NSString</span> *text =<span class="string">@"我同意《XX在线服务协议》及《XX在线用户信息及隐私保护规则》"</span>;</div><div class="line"><span class="built_in">NSMutableAttributedString</span> *MAttributedString = [[<span class="built_in">NSMutableAttributedString</span> alloc] initWithString:text];</div><div class="line"><span class="comment">//《XX在线服务协议》</span></div><div class="line">    <span class="built_in">NSRange</span> range1 = <span class="built_in">NSMakeRange</span>(<span class="number">3</span>, <span class="number">10</span>);</div><div class="line">    [MAttributedString addAttributes:@&#123;<span class="built_in">NSLinkAttributeName</span>:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"string1://"</span>]                                            &#125; range:range1];</div><div class="line">    <span class="comment">//《XX在线用户信息及隐私保护规则》</span></div><div class="line">    <span class="built_in">NSRange</span> range2 = <span class="built_in">NSMakeRange</span>(<span class="number">14</span>, <span class="number">17</span>);</div><div class="line">    [MAttributedString addAttributes:@&#123;<span class="built_in">NSLinkAttributeName</span>:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"string2://"</span>]&#125;range:range2];</div><div class="line">    [MAttributedString endEditing];</div></pre></td></tr></table></figure>
<p>textView的设置</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line"><span class="built_in">UITextView</span> *textView = [[<span class="built_in">UITextView</span> alloc]initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">20</span>,<span class="number">100</span>, SCREEN_WIDTH  - <span class="number">20</span>,<span class="number">50</span>)];</div><div class="line">textView.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">20</span>];</div><div class="line">textView.scrollEnabled = <span class="literal">NO</span>;</div><div class="line">textView.textContainerInset = <span class="built_in">UIEdgeInsetsMake</span>(<span class="number">0</span>, <span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>);</div><div class="line">textView.text = text;</div><div class="line">textView.textColor = [<span class="built_in">UIColor</span> blackColor];</div><div class="line"><span class="comment">//必须设为NO不然不能响应点击事件</span></div><div class="line">textView.editable = <span class="literal">NO</span>;</div><div class="line"><span class="comment">//设置链接的属性 设置那一段颜色</span></div><div class="line"><span class="built_in">NSDictionary</span> *linkAttributes =@&#123;</div><div class="line">                                <span class="built_in">NSForegroundColorAttributeName</span>:[<span class="built_in">UIColor</span> redColor]&#125;;</div><div class="line">textView.linkTextAttributes = linkAttributes;</div><div class="line"></div><div class="line"><span class="comment">/** 设置自动检测类型为链接网址. */</span></div><div class="line">textView.dataDetectorTypes = <span class="built_in">UIDataDetectorTypeAll</span>;</div><div class="line">textView.delegate = <span class="keyword">self</span>;</div><div class="line">textView.attributedText = MAttributedString;</div><div class="line">[<span class="keyword">self</span>.view addSubview:textView];</div></pre></td></tr></table></figure>
<p>那两段文字的点击事件，在UItextView Delegate中实现</p>
<figure class="highlight objc"><table><tr><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)textView:(<span class="built_in">UITextView</span> *)textView shouldInteractWithURL:(<span class="built_in">NSURL</span> *)URL inRange:(<span class="built_in">NSRange</span>)characterRange</div><div class="line">&#123;</div><div class="line">    <span class="comment">// 在代理方法回调的时候，如果没有“://”的话，在[URL scheme]方法里取不到特定的值，一句话://前面的才是最重要的标识符</span></div><div class="line">    <span class="keyword">if</span> ([[URL scheme] rangeOfString:<span class="string">@"string1"</span>].location != <span class="built_in">NSNotFound</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"点击《XX在线服务协议》"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ([[URL scheme] rangeOfString:<span class="string">@"string2"</span>].location != <span class="built_in">NSNotFound</span>)&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"点击《XX在线用户信息及隐私保护规则》"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</div></article></div><div id="disqus_thread"></div></div><script>var disqus_shortname = 'Winter';
var disqus_identifier = '2017/02/21/textView/';
var disqus_title = 'TextView添加链接';
var disqus_url = 'https://winterliao.github.io/2017/02/21/textView/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//Winter.disqus.com/count.js" async></script></main><footer class="footer-container"><div class="paginator"><a href="/2017/03/13/frameWork/" class="prev">上一篇</a><a href="/2016/12/24/hello-world/" class="next">下一篇</a></div><div class="copyright"><p>© 2017 - 2018 <a href="https://winterliao.github.io">廖文韬</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"Winter",'auto');ga('send','pageview');</script></body></html>